<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>dance</title>
    <link rel="stylesheet" href="main.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="select.js"></script>
    <script src="result.js"></script>
    <script src="playing.js"></script>
    <script type="text/javascript" src="/eel.js"></script>
  </head>
  <script type="text/javascript">
  </script>
  <body>
    <div class="underTheEarth">
      
      <!-- buttons -->
      <button onclick="history.back()" class="simple_square_btn3" style="width:100px;height:50px">選択画面へ戻る</button>
      <button onclick="GoToResult()" class="btn-flat-stripe3" style="width:150px;height:80px">結果表示</button>

      <!-- score -->
      <div class="camera">
	<video id="camera" width="1500" height="700"></video>
      </div>
      <!-- <audio id="se" preload="auto">
	<source src="Hyoshigi01-1.mp3" type="audio/mp3">
      </audio> -->
      
      　<br>
      <center>
	<button onclick="Play1()" class="btn-flat-stripe1" style="width:150px;height:80px">再生</button>
	<button onclick="Pause1()" class="btn-flat-stripe2" style="width:150px;height:80px">一時停止</button>
	<button onclick="PlayFromFirst1()" class="btn-flat-stripe3" style="width:150px;height:80px">最初から再生</button>
       
      </center>
      
      <!-- 再生終了すると結果画面へ -->
      <video playsinline muted autoplay onended="">
	<!-- 動画指定場所 -->
	<source src="../data/0000.mp4">
      </video>
      
    </div>

    <script type="text/javascript">
      //再生
  //     function Play1(){
  //   document.getElementById("test1").play();
  // }
  
  function Play1(){

        var id = setInterval(function(){
                commToPy();
        }, 1000); //50ms ごとにpython側へ動画の再生時間の情報を送る
}

var time = 1;
async function commToPy() {
    //console.log("test");
    time ++;
    let val = await eel.disp_score(time)();
    //console.log(val + " from Python");

    //deleteCanvas();
    //drawMatchRate(val.score);
    //drawStickFig(val.landmark);
}

	//一時停止
	function Pause1(){
	    document.getElementById("test1").pause();
	}
	//最初から再生
	function PlayFromFirst1(){
	    document.getElementById("test1").currentTime=0;
	    document.getElementById("test1").play();
	}
	
	window.onload = () => {
	    const video  = document.querySelector("#camera");
	    const canvas = document.querySelector("#picture");
	    const se     = document.querySelector('#se');

	    //カメラ設定
	    const constraints = {
		audio: false,
		video: {
		    width: 500,
		    height: 300,
		    facingMode: "user"   // フロントカメラを利用する
		    // facingMode: { exact: "environment" }  // リアカメラを利用する場合
		}
	    };

	    //カメラを<video>と同期
	    navigator.mediaDevices.getUserMedia(constraints)
		.then( (stream) => {
		    video.srcObject = stream;
		    video.onloadedmetadata = (e) => {
			video.play();
		    };
		})
		.catch( (err) => {
		    console.log(err.name + ": " + err.message);
		});

	};
      </script>

  </body>
</html>
